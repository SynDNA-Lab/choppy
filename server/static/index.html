<form id="uploadForm" enctype="multipart/form-data">
    <div>
        <label>Query Sequence:</label>
        <input type="file" name="query_file" accept=".gb,.gbk,.genbank,.fa,.fasta" required>
    </div>
    
    <div>
        <label>Background Sequences:</label>
        <input type="file" name="background_files" accept=".gb,.gbk,.genbank,.fa,.fasta" multiple>
    </div>
    
    <div>
        <label>K-mer Size:</label>
        <input type="number" name="kmer_size" value="20">
    </div>
    
    <div>
        <label>Threshold:</label>
        <input type="number" name="threshold" value="60">
    </div>
    
    <button type="submit">Process</button>
</form>

<script>
document.getElementById('uploadForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    
    try {
        const response = await fetch('/annotate-homology', {
            method: 'POST',
            body: formData
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        // Get the filename from Content-Disposition header
        const contentDisposition = response.headers.get('Content-Disposition');
        let filename = 'annotated_sequences.gb';
        if (contentDisposition) {
            const filenameMatch = contentDisposition.match(/filename="?(.+)"?/);
            if (filenameMatch) {
                filename = filenameMatch[1];
            }
        }
        
        // Get the file content as a blob
        const blob = await response.blob();
        
        // Create a download link and trigger it
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        
        // Clean up
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);

    } catch (error) {
        console.error('Error:', error);
        alert('Error processing file: ' + error.message);
    }
});
</script>